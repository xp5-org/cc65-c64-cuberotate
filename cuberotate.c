#include <tgi.h>  // CC65's TGI library

//lut - values scaled by 1000 to avoid floating point math
const int sine[360] = {
     0,   17,   35,   52,   70,   87,  105,  122,  139,  156,  174,  191,  208,  225,  241,  258, 
   275,  292,  309,  325,  342,  358,  374,  390,  406,  422,  438,  454,  469,  485,  500,  515, 
   530,  545,  559,  574,  588,  602,  616,  629,  643,  656,  669,  682,  694,  707,  719,  731, 
   743,  755,  766,  777,  788,  798,  809,  819,  829,  838,  848,  857,  866,  874,  883,  891, 
   899,  906,  914,  921,  928,  934,  940,  946,  951,  957,  962,  967,  971,  975,  979,  983, 
   986,  989,  992,  994,  996,  998,  999, 1000, 1000, 1000, 1000,  999,  998,  996,  994,  992, 
   989,  986,  983,  979,  975,  971,  967,  962,  957,  951,  946,  940,  934,  928,  921,  914, 
   906,  899,  891,  883,  874,  866,  857,  848,  838,  829,  819,  809,  798,  788,  777,  766, 
   755,  743,  731,  719,  707,  694,  682,  669,  656,  643,  629,  616,  602,  588,  574,  559, 
   545,  530,  515,  500,  485,  469,  454,  438,  422,  406,  390,  374,  358,  342,  325,  309, 
   292,  275,  258,  241,  225,  208,  191,  174,  156,  139,  122,  105,   87,   70,   52,   35, 
    17,    1,  -17,  -35,  -52,  -70,  -87, -105, -122, -139, -156, -174, -191, -208, -225, -241, 
  -258, -275, -292, -309, -325, -342, -358, -374, -390, -406, -422, -438, -454, -469, -485, -500, 
  -515, -530, -545, -559, -574, -588, -602, -616, -629, -643, -656, -669, -682, -694, -707, -719, 
  -731, -743, -755, -766, -777, -788, -798, -809, -819, -829, -838, -848, -857, -866, -874, -883, 
  -891, -899, -906, -914, -921, -928, -934, -940, -946, -951, -957, -962, -967, -971, -975, -979, 
  -983, -986, -989, -992, -994, -996, -998, -999, -1000, -1000, -1000, -1000, -999, -998, -996, 
  -994, -992, -989, -986, -983, -979, -975, -971, -967, -962, -957, -951, -946, -940, -934, -928, 
  -921, -914, -906, -899, -891, -883, -874, -866, -857, -848, -838, -829, -819, -809, -798, -788, 
  -777, -766, -755, -743, -731, -719, -707, -694, -682, -669, -656, -643, -629, -616, -602, -588, 
  -574, -559, -545, -530, -515, -500, -485, -469, -454, -438, -422, -406, -390, -374, -358, -342, 
  -325, -309, -292, -275, -258, -241, -225, -208, -191, -174, -156, -139, -122, -105,  -87,  -70, 
   -52,  -35,  -17
};

const int cosine[360] = {
  1000,  999,  999,  998,  996,  994,  992,  989,  986,  983,  979,  975,  971,  967,  962,  957, 
   951,  946,  940,  934,  928,  921,  914,  906,  899,  891,  883,  874,  866,  857,  848,  838, 
   829,  819,  809,  798,  788,  777,  766,  755,  743,  731,  719,  707,  694,  682,  669,  656, 
   643,  629,  616,  602,  588,  574,  559,  545,  530,  515,  500,  485,  469,  454,  438,  422, 
   406,  390,  374,  358,  342,  325,  309,  292,  275,  258,  241,  225,  208,  191,  174,  156, 
   139,  122,  105,   87,   70,   52,   35,   17,    1,  -17,  -35,  -52,  -70,  -87, -105, -122, 
  -139, -156, -174, -191, -208, -225, -241, -258, -275, -292, -309, -325, -342, -358, -374, -390, 
  -406, -422, -438, -454, -469, -485, -500, -515, -530, -545, -559, -574, -588, -602, -616, -629, 
  -643, -656, -669, -682, -694, -707, -719, -731, -743, -755, -766, -777, -788, -798, -809, -819, 
  -829, -838, -848, -857, -866, -874, -883, -891, -899, -906, -914, -921, -928, -934, -940, -946, 
  -951, -957, -962, -967, -971, -975, -979, -983, -986, -989, -992, -994, -996, -998, -999, -1000, 
 -1000, -1000, -1000, -999, -998, -996, -994, -992, -989, -986, -983, -979, -975, -971, -967, -962, 
  -957, -951, -946, -940, -934, -928, -921, -914, -906, -899, -891, -883, -874, -866, -857, -848, 
  -838, -829, -819, -809, -798, -788, -777, -766, -755, -743, -731, -719, -707, -694, -682, -669, 
  -656, -643, -629, -616, -602, -588, -574, -559, -545, -530, -515, -500, -485, -469, -454, -438, 
  -422, -406, -390, -374, -358, -342, -325, -309, -292, -275, -258, -241, -225, -208, -191, -174, 
  -156, -139, -122, -105,  -87,  -70,  -52,  -35,  -17,    0
};

// vertices for 100x100x100 cube
long x0 = -50, y0 = -50, z0 = -50;
long x1 =  50, y1 = -50, z1 = -50;
long x2 =  50, y2 =  50, z2 = -50;
long x3 = -50, y3 =  50, z3 = -50;
long x4 = -50, y4 = -50, z4 =  50;
long x5 =  50, y5 = -50, z5 =  50;
long x6 =  50, y6 =  50, z6 =  50;
long x7 = -50, y7 =  50, z7 =  50;

//starting angles 0-360
long rotX = 0;
long rotY = 0;
long rotZ = 0;

void rotate_x(long *y, long *z, long angle) {
    long tempY = *y;
    long tempZ = *z;
    *y = (tempY * cosine[angle] - tempZ * sine[angle]) / 1000;
    *z = (tempY * sine[angle] + tempZ * cosine[angle]) / 1000;
}

void rotate_y(long *x, long *z, long angle) {
    long tempX = *x;
    long tempZ = *z;
    *x = (tempX * cosine[angle] + tempZ * sine[angle]) / 1000;
    *z = (tempZ * cosine[angle] - tempX * sine[angle]) / 1000;
}

void rotate_z(long *x, long *y, long angle) {
    long tempX = *x;
    long tempY = *y;
    *x = (tempX * cosine[angle] - tempY * sine[angle]) / 1000;
    *y = (tempX * sine[angle] + tempY * cosine[angle]) / 1000;
}


void draw_cube() {
    long tx0 = x0, ty0 = y0, tz0 = z0;
    long tx1 = x1, ty1 = y1, tz1 = z1;
    long tx2 = x2, ty2 = y2, tz2 = z2;
    long tx3 = x3, ty3 = y3, tz3 = z3;
    long tx4 = x4, ty4 = y4, tz4 = z4;
    long tx5 = x5, ty5 = y5, tz5 = z5;
    long tx6 = x6, ty6 = y6, tz6 = z6;
    long tx7 = x7, ty7 = y7, tz7 = z7;

    rotate_x(&ty0, &tz0, rotX); rotate_y(&tx0, &tz0, rotY); rotate_z(&tx0, &ty0, rotZ);
    rotate_x(&ty1, &tz1, rotX); rotate_y(&tx1, &tz1, rotY); rotate_z(&tx1, &ty1, rotZ);
    rotate_x(&ty2, &tz2, rotX); rotate_y(&tx2, &tz2, rotY); rotate_z(&tx2, &ty2, rotZ);
    rotate_x(&ty3, &tz3, rotX); rotate_y(&tx3, &tz3, rotY); rotate_z(&tx3, &ty3, rotZ);
    rotate_x(&ty4, &tz4, rotX); rotate_y(&tx4, &tz4, rotY); rotate_z(&tx4, &ty4, rotZ);
    rotate_x(&ty5, &tz5, rotX); rotate_y(&tx5, &tz5, rotY); rotate_z(&tx5, &ty5, rotZ);
    rotate_x(&ty6, &tz6, rotX); rotate_y(&tx6, &tz6, rotY); rotate_z(&tx6, &ty6, rotZ);
    rotate_x(&ty7, &tz7, rotX); rotate_y(&tx7, &tz7, rotY); rotate_z(&tx7, &ty7, rotZ);

    tgi_clear();  // wipe screen before redraw

    tgi_line(tx0 + 100, ty0 + 100, tx1 + 100, ty1 + 100);
    tgi_line(tx1 + 100, ty1 + 100, tx2 + 100, ty2 + 100);
    tgi_line(tx2 + 100, ty2 + 100, tx3 + 100, ty3 + 100);
    tgi_line(tx3 + 100, ty3 + 100, tx0 + 100, ty0 + 100);

    tgi_line(tx4 + 100, ty4 + 100, tx5 + 100, ty5 + 100);
    tgi_line(tx5 + 100, ty5 + 100, tx6 + 100, ty6 + 100);
    tgi_line(tx6 + 100, ty6 + 100, tx7 + 100, ty7 + 100);
    tgi_line(tx7 + 100, ty7 + 100, tx4 + 100, ty4 + 100);

    tgi_line(tx0 + 100, ty0 + 100, tx4 + 100, ty4 + 100);
    tgi_line(tx1 + 100, ty1 + 100, tx5 + 100, ty5 + 100);
    tgi_line(tx2 + 100, ty2 + 100, tx6 + 100, ty6 + 100);
    tgi_line(tx3 + 100, ty3 + 100, tx7 + 100, ty7 + 100);
}

int main() {
    tgi_install(tgi_static_stddrv);
    tgi_init();      
    tgi_clear();
    rotX = 0;
    rotY = 0;
    rotZ = 0;
  
      while (1) {
        
        rotX += 6;
        rotY += 2;
        rotZ += 4;

        if (rotX >= 360) rotX = 0;
        if (rotY >= 360) rotY = 0;
        if (rotZ >= 360) rotZ = 0;

        draw_cube();
          }

    draw_cube();
    while (1);

    return 0;
}
